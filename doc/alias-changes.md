# 别名变化图

## 各命令对别名的影响

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          别名版本变化详解                                    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 初始状态 (首次部署后)

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  Versions:  $LATEST ─── v1                                      │
│                          │                                      │
│  Aliases:   live ────────┤                                      │
│             latest ──────┤                                      │
│             previous ────┘                                      │
│                                                                 │
│  流量: live (100%) ──────────────────────────────► v1           │
└─────────────────────────────────────────────────────────────────┘
```

### sam deploy 后 (新版本创建)

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  Versions:  $LATEST ─── v1 ─── v2                               │
│                                 │                               │
│  Aliases:   live ───────────────┤  (SAM 更新所有别名到 v2)       │
│             latest ─────────────┤                               │
│             previous ───────────┘                               │
│                                                                 │
│  流量: live (100%) ──────────────────────────────► v2           │
│                                                                 │
│  ⚠️ 问题: 新版本直接上线，无灰度验证                              │
└─────────────────────────────────────────────────────────────────┘
```

### lad deploy 后 (别名调整)

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  Versions:  $LATEST ─── v1 ─── v2                               │
│                          │      │                               │
│  Aliases:   live ────────┘      │                               │
│             latest ─────────────┘                               │
│             previous ────┘                                      │
│                                                                 │
│  流量: live (100%) ──────────────────────────────► v1           │
│                                                                 │
│  ✓ live 保持旧版本，latest 指向新版本供测试                       │
└─────────────────────────────────────────────────────────────────┘
```

### lad canary --strategy canary10

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  Versions:  $LATEST ─── v1 ─── v2                               │
│                          │      │                               │
│  Aliases:   live ────────┴──────┘ (带权重)                       │
│             latest ─────────────┘                               │
│             previous ────┘                                      │
│                                                                 │
│  流量: live ─┬─ 90% ─────────────────────────────► v1           │
│             └─ 10% ─────────────────────────────► v2           │
└─────────────────────────────────────────────────────────────────┘
```

### lad canary --strategy canary50

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  流量: live ─┬─ 50% ─────────────────────────────► v1           │
│             └─ 50% ─────────────────────────────► v2           │
└─────────────────────────────────────────────────────────────────┘
```

### lad promote (完成灰度)

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  Versions:  $LATEST ─── v1 ─── v2                               │
│                          │      │                               │
│  Aliases:   live ────────┼──────┘                               │
│             latest ──────┼──────┘                               │
│             previous ────┘                                      │
│                                                                 │
│  流量: live (100%) ──────────────────────────────► v2           │
│                                                                 │
│  ✓ previous 保存 v1，可用于回退                                  │
└─────────────────────────────────────────────────────────────────┘
```

### lad rollback (紧急回退)

```
┌─────────────────────────────────────────────────────────────────┐
│                        Lambda Function                          │
├─────────────────────────────────────────────────────────────────┤
│  Versions:  $LATEST ─── v1 ─── v2                               │
│                          │                                      │
│  Aliases:   live ────────┤                                      │
│             latest ──────┤                                      │
│             previous ────┘                                      │
│                                                                 │
│  流量: live (100%) ──────────────────────────────► v1           │
│                                                                 │
│  ✓ 立即回退到 previous 版本                                      │
└─────────────────────────────────────────────────────────────────┘
```

## 命令影响汇总

| 命令 | live | latest | previous | 流量分配 |
|------|------|--------|----------|----------|
| sam deploy | → vN+1 | → vN+1 | → vN+1 | 100% vN+1 |
| lad deploy | → vN | → vN+1 | → vN | 100% vN |
| lad canary 0 | vN | vN+1 | vN | 100% vN (清除灰度) |
| lad canary 10 | vN/vN+1 | vN+1 | vN | 90/10 |
| lad canary 25 | vN/vN+1 | vN+1 | vN | 75/25 |
| lad canary 50 | vN/vN+1 | vN+1 | vN | 50/50 |
| lad canary 75 | vN/vN+1 | vN+1 | vN | 25/75 |
| lad canary 100 | vN/vN+1 | vN+1 | vN | 0/100 |
| lad auto | 递进 | vN+1 | → vN | 10→25→50→75→100 |
| lad promote | → vN+1 | vN+1 | → vN | 100% vN+1 |
| lad rollback | → vN | → vN | vN | 100% vN |
