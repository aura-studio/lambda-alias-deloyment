# 状态图 - 别名状态流转

## 部署状态机

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              LAD 状态流转图                                  │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌──────────┐
                              │  初始态   │
                              │ (未部署)  │
                              └────┬─────┘
                                   │
                                   │ sam deploy + lad deploy
                                   ▼
                              ┌──────────┐
                              │  稳定态   │◄─────────────────────┐
                              │          │                      │
                              │ live=v1  │                      │
                              │latest=v1 │                      │
                              │ prev=v1  │                      │
                              └────┬─────┘                      │
                                   │                            │
                                   │ sam deploy + lad deploy    │
                                   ▼                            │
                              ┌──────────┐                      │
                              │ 待验证态  │                      │
                              │          │                      │
                              │ live=v1  │                      │ lad promote
                              │latest=v2 │                      │
                              │ prev=v1  │                      │
                              └────┬─────┘                      │
                                   │                            │
                                   │ lad canary                 │
                                   ▼                            │
                              ┌──────────┐                      │
                              │  灰度态   │──────────────────────┘
                              │          │
                              │live=v1/v2│ (流量分配)
                              │latest=v2 │
                              │ prev=v1  │
                              └────┬─────┘
                                   │
                                   │ lad rollback
                                   ▼
                              ┌──────────┐
                              │ 回退态    │
                              │          │
                              │ live=v1  │
                              │latest=v1 │
                              │ prev=v1  │
                              └──────────┘
```

## 状态说明

| 状态 | 描述 | live | latest | previous |
|------|------|------|--------|----------|
| 初始态 | 首次部署前 | - | - | - |
| 稳定态 | 正常运行 | vN | vN | vN-1 |
| 待验证态 | 新版本已部署，待灰度 | vN | vN+1 | vN-1 |
| 灰度态 | 流量分配中 | vN→vN+1 | vN+1 | vN |
| 回退态 | 紧急回退后 | vN | vN | vN |
